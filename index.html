<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Egg</title>
	</head>

	<body>
		<script>
			var true_rarities = [250, 500, 1000, 2000, 5000, 10000, 25000, 50000, 75000, 100000, 250000, 500000, 750000, 1000000, 5000000, 10000000, 100000000, 1000000000, 10000000000, 100000000000, 1000000000000, 5000000000000, 10000000000000];

			function sim_power(sauce, rarities) {
				let rarest_index = 0;
				for (let i = 0; i < sauce; i++)
				{
					let rng = Math.random();
					for (let r = rarities.length - 1; r >= 0; r--)
					{
						if (rarest_index < r)
						{
							if (rng < rarities[r])
								rarest_index = r;
						}
					}
				}
				return rarest_index;
			}

			function calc_power(sauce) {
				let new_rarities = [];
				let result = 0;
				let result_index;
				let multiplier = 1;
				if (sauce > 10000)
				{
					multiplier = sauce / 10000;
					sauce = 10000;
				}
				for (let i = 0; i < true_rarities.length; i++)
				{
					new_rarities[i] = 1 / (true_rarities[i] / multiplier);
				}
				result_index = sim_power(sauce, new_rarities);
				result = true_rarities[result_index];
				return (result);
			}

			function shorten_number_by_magnitude(number)
			{
				let magnitudes = ['', 'k', 'm', 'b', 't'];
				let i = 0;
				while (number >= 1000)
				{
					number /= 1000;
					i++;
				}
				return (number + magnitudes[i]);
			}

			function simple_power_sim(sauce)
			{
				reset_list();
				result = calc_power(sauce);
				result = shorten_number_by_magnitude(result);
				if (result == "5t")
					result = "Glas / Goch";
				else if (result == "10t")
					result = "Bla / Rod";

				document.getElementById("power_result").innerHTML = result + "<br>" + document.getElementById("power_result").innerHTML;
			}

			function multi_power_sim(sauce, amount)
			{
				let rarity_count = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

				reset_list();
				let i = 0;
				let update_ratio = Math.floor(amount / 1000);
				let refreshIntervalID = setInterval(function() {
					if (i < amount && amount <= 1000)
					{
						result = calc_power(sauce);
						let rarity_index = true_rarities.findIndex(x => x === result);
						if (rarity_index == -1)
							return;
						rarity_count[rarity_index]++;
						result = shorten_number_by_magnitude(result);
						console.log(result);
						if (result == "5t")
							document.getElementById("power_result_" + result).innerHTML = "Glas / Goch: " + rarity_count[rarity_index];
						else if (result == "10t")
							document.getElementById("power_result_" + result).innerHTML = "Bla / Rod: " + rarity_count[rarity_index];
						else
							document.getElementById("power_result_" + result).innerHTML = result + ": " + rarity_count[rarity_index];
						update_list(rarity_count, rarity_index, result);
						i++;
					}
					else if (i < amount)
					{
						if (amount - i < update_ratio)
							update_ratio = amount - i;
						for (let j = 0; j < update_ratio; j++)
						{
							result = calc_power(sauce);
							let rarity_index = true_rarities.findIndex(x => x === result);
							if (rarity_index == -1)
								return;
							rarity_count[rarity_index]++;
							result = shorten_number_by_magnitude(result);
							console.log(result);
							if (result == "5t")
								document.getElementById("power_result_" + result).innerHTML = "Glas / Goch: " + rarity_count[rarity_index];
							else if (result == "10t")
								document.getElementById("power_result_" + result).innerHTML = "Bla / Rod: " + rarity_count[rarity_index];
							else
								document.getElementById("power_result_" + result).innerHTML = result + ": " + rarity_count[rarity_index];
							update_list(rarity_count, rarity_index, result);
							i++;
						}
					}
					else
					{
						clearInterval(refreshIntervalID);
					}
				}, 0);
				/*
				for (let i = 0; i < amount; i++)
				{
					result = calc_power(sauce);
					let rarity_index = true_rarities.findIndex(x => x === result);
					if (rarity_index == -1)
						return;
					rarity_count[rarity_index]++;
					result = shorten_number_by_magnitude(result);
					console.log(result);
					if (result == "5t")
						document.getElementById("power_result_" + result).innerHTML = "Glas / Goch: " + rarity_count[rarity_index];
					else if (result == "10t")
						document.getElementById("power_result_" + result).innerHTML = "Bla / Rod: " + rarity_count[rarity_index];
					else
						document.getElementById("power_result_" + result).innerHTML = result + ": " + rarity_count[rarity_index];
					update_list(rarity_count, rarity_index, result);
					//if (result == "5t")
					//	result = "Glas / Goch";
					//else if (result == "10t")
					//	result = "Bla / Rod";
					// document.getElementById("power_result").innerHTML = result;
					// I wanted this to "roll" but it doesn't seem to want to
				}
				*/
			}

			function update_list(rarity_count, rarity_index, rarity)
			{
				if (rarity == "5t")
					document.getElementById("power_result_" + rarity).innerHTML = "Glas / Goch: " + rarity_count[rarity_index];
				else if (rarity == "10t")
					document.getElementById("power_result_" + rarity).innerHTML = "Bla / Rod: " + rarity_count[rarity_index];
				else
					document.getElementById("power_result_" + rarity).innerHTML = rarity + ": " + rarity_count[rarity_index];
			}

			setTimeout(function() {
				update_list(rarity_count, rarity_index, rarity);
			}, 0);

			function reset_list()
			{
				let divs = document.getElementsByName("power");
				for (let i = 0; i < divs.length; i++)
					divs[i].innerHTML = "";
			}
		 </script>
		<h1>Hi achase, I'm messing around with JS</h1>
		<p>
			Enter the sauce you'd like to calculate powers here: <br>
			<i><b>NOTE:</b> Abbreviations such as "10m" don't work!</i>
		</p>
		<input type="text" id="sauce_input"> <br>
		<div>
			<button onclick = "simple_power_sim(document.getElementById('sauce_input').value)">Calculate!</button>
			<button onclick = "multi_power_sim(document.getElementById('sauce_input').value, 100)">x100</button>
			<button onclick = "multi_power_sim(document.getElementById('sauce_input').value, 1000)">x1000</button>
			<button onclick = "multi_power_sim(document.getElementById('sauce_input').value, 10000)">x10k</button>
			<button onclick = "multi_power_sim(document.getElementById('sauce_input').value, 100000)">x100k</button>
			<button onclick = "multi_power_sim(document.getElementById('sauce_input').value, 1000000)">x1m</button>
		</div>
		<p>
			<div id="power_result" name="power"></div>
			<div id="power_result_250" name="power"></div>
			<div id="power_result_500" name="power"></div>
			<div id="power_result_1k" name="power"></div>
			<div id="power_result_2k" name="power"></div>
			<div id="power_result_5k" name="power"></div>
			<div id="power_result_10k" name="power"></div>
			<div id="power_result_25k" name="power"></div>
			<div id="power_result_50k" name="power"></div>
			<div id="power_result_75k" name="power"></div>
			<div id="power_result_100k" name="power"></div>
			<div id="power_result_250k" name="power"></div>
			<div id="power_result_500k" name="power"></div>
			<div id="power_result_750k" name="power"></div>
			<div id="power_result_1m" name="power"></div>
			<div id="power_result_5m" name="power"></div>
			<div id="power_result_10m" name="power"></div>
			<div id="power_result_100m" name="power"></div>
			<div id="power_result_1b" name="power"></div>
			<div id="power_result_10b" name="power"></div>
			<div id="power_result_100b" name="power"></div>
			<div id="power_result_1t" name="power"></div>
			<div id="power_result_5t" name="power"></div>
			<div id="power_result_10t" name="power"></div>
		</p>
	</body>

</html>